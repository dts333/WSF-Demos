<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body><style>body{max-width:800px;margin:50px auto;padding:0;background-color:#000;color:#fff;font-size:21px;font-family:sans-serif}.play-button{margin-top:1.5em;margin-bottom:1em;width:5em;font-size:15px}.slider-label{margin-right:1em;display:inline-block}.div-below-slider{padding-top:10px}.highlighted-text{color:#5df}.viz-canvas{padding-top:1em}.sci-num{padding-right:.15em}.eqn-left{text-align:right}.eqn-middle{padding-left:.25em;padding-right:.25em}.eqn-right{text-align:left}input[type=range]{-webkit-appearance:none;-moz-apperance:none;width:40%;height:8px;padding:0 0;background:#8b8f92;border-radius:2px;margin-top:25px;position:relative;bottom:4px}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;-moz-apperance:none;width:25px;height:25px;-webkit-border-radius:20px;-moz-border-radius:20px;-ms-border-radius:20px;-o-border-radius:20px;border-radius:20px;background-image:-webkit-gradient(linear,left top,left bottom,color-stop(0,#fefefe),color-stop(.49,#d7d7d7),color-stop(.51,#d1d1d1),color-stop(1,#c8c8c8));border:1px solid #787878}input[type=range]::-moz-range-thumb{box-shadow:1px 1px 1px #000,0 0 1px #0d0d0d;border:1px solid #000;height:20px;width:20px;border-radius:20px;background:#fff;cursor:pointer}input[type=range]::-ms-thumb{box-shadow:1px 1px 1px #000,0 0 1px #0d0d0d;border:1px solid #000;height:20px;width:20px;border-radius:20px;background:#fff;cursor:pointer}</style>
<div>
<span>
<label>
<span class="slider-label">Train speed:</span>
<input id="input-train-speed" max="0.5" min="0" name="input-train-speed" oninput="updateTrainSpeed(this.value)" step=".005" type="range" value=".0"/>
</label>
</span>
<div class="div-below-slider" id="div-speed-info">
<span class="eqn-left">ùë£</span><span class="eqn-middle">=</span><span class="sci-num highlighted-text eqn-right" id="train-speed-text">0.1</span>ùëê
</div>
</div>
<div>
<button class="play-button" id="btn-run-animation" onclick="beginAnimation()">
Start
</button>
<button class="play-button" disabled="" id="btn-reset-animation" onclick="stopAnimation()">
Reset
</button>
</div>
<svg class="viz-canvas" id="canvas" style="margin: 0 auto; display: block;" xmlns="http://www.w3.org/2000/svg"></svg>
<script type="text/javascript">"use strict";const AESTHETIC={solidFill:"#4ff8",solidStroke:"#fff8",durationMSOfAnimationReset:300,easingForAnimationReset:d3.easePoly.exponent(2.5),configure:function(t,a){return Object.entries(a).forEach(([a,n])=>{if("attrs"===a){const a=n;Object.entries(a).forEach(([a,n])=>{t.attr(a,n)})}else{if("class"!==a)throw new Error(`Unexpected key ${a}`);t.classed(n,!0)}}),t}},USER_INFO={trainSpeed:.1},CONFIG=Object.freeze({xMarginProptn:0,yMarginProptn:.15,trainWidthProptn:.4,trainHeightProptn:.6,nTiesVisible:9,axDistTraveledAsFracOfTrainWidth:1.2,maxTrainSpeed:.5,trainCar:{class:"train-car",attrs:{fill:AESTHETIC.solidFill,stroke:AESTHETIC.solidStroke}},trainLightSource:{class:"train-light-source",attrs:{fill:"white",stroke:"white"}},trainPhoton:{class:"train-photon",attrs:{fill:"#fff8",stroke:"white"}},railroadTie:{class:"railroad-tie",attrs:{stroke:"white","stroke-width":6}},railroadRail:{class:"railroad-rail",attrs:{stroke:"white","stroke-width":5}},canvasText:{attrs:{fill:"white","font-size":"30px","font-family":"sans-serif"}}});function toTitleCase(t){return t.replace(/\b\w+/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}function updateTrainSpeed(t,{initial:a=!1}={}){const n=void 0!==t?t:document.getElementById("input-train-speed").value;try{const t=parseFloat(n);(t<0||t>1)&&console.log(`Got invalid speed (outside [0,1]): ${t}`);const a=Math.max(0,Math.min(t,1));USER_INFO.trainSpeed=a,document.getElementById("train-speed-text").textContent=(+n).toFixed(3)}catch(t){console.log(n)}}function getRailroadTieParams({trackInteriorAxMinX:t,trackInteriorAxMaxX:a,nTiesVisible:n}){const e=(a-t)/(n-1);return{axDistBtwnTies:e,initialTieAxX:(t+a)/2-Math.floor((n-1)/2)*e}}document.getElementById("input-train-speed").max=`${CONFIG.maxTrainSpeed}`;const X_MARGIN_PROPTN=0,Y_MARGIN_PROPTN=.15,TRAIN_WIDTH_PROPTN=.75,TRAIN_HEIGHT_PROPTN=.6,THIS_DEMO_SPEED_MULTIPLIER=.5/CONFIG.axDistTraveledAsFracOfTrainWidth,AX_MIN_X=5,AX_MIN_Y=3,AX_MAX_X=10,AX_MAX_Y=7,AX_WIDTH=AX_MAX_X-AX_MIN_X,AX_HEIGHT=AX_MAX_Y-AX_MIN_Y,AX_MID_X=AX_MIN_X+(AX_MAX_X-AX_MIN_X)/2,AX_MID_Y=AX_MIN_Y+(AX_MAX_Y-AX_MIN_Y)/2,AX_TRAIN_WIDTH=AX_WIDTH*TRAIN_WIDTH_PROPTN,AX_TRAIN_HEIGHT=.6*AX_HEIGHT,TOTAL_DURATION_SEC=3,TOTAL_DURATION_MS=3e3,CANVAS_WIDTH=800,CANVAS_HEIGHT=400,canvas=d3.select("#canvas").attr("width",CANVAS_WIDTH).attr("height",CANVAS_HEIGHT).style("background-color","black");function axDistTraveled({fracOfC:t}){return t*AX_TRAIN_WIDTH*CONFIG.axDistTraveledAsFracOfTrainWidth*THIS_DEMO_SPEED_MULTIPLIER}function transAxisToCanvas({x:t,y:a,dx:n,dy:e}){return{x:CANVAS_WIDTH*X_MARGIN_PROPTN+(t-AX_MIN_X)/AX_WIDTH*CANVAS_WIDTH*(1-2*X_MARGIN_PROPTN),y:CANVAS_HEIGHT*Y_MARGIN_PROPTN+(a-AX_MIN_Y)/AX_HEIGHT*CANVAS_HEIGHT*(1-2*Y_MARGIN_PROPTN),dx:CANVAS_WIDTH/AX_WIDTH*n,dy:CANVAS_HEIGHT/AX_HEIGHT*e}}function x1(t){return t.p1.x}function y1(t){return t.p1.y}function x2(t){return t.p2.x}function y2(t){return t.p2.y}function addTrainAndLightSources(t){const a=AX_MID_X-AX_TRAIN_WIDTH/2,n=AX_MID_Y-AX_TRAIN_HEIGHT/2,e=a+AX_TRAIN_WIDTH,i=n+AX_TRAIN_HEIGHT,r=transAxisToCanvas({x:a,y:n}),o=transAxisToCanvas({x:e,y:i}),s=o.x-r.x,A=o.y-r.y;AESTHETIC.configure(t.append("rect").attr("x",r.x).attr("y",r.y).attr("width",s).attr("height",A),CONFIG.trainCar);const T=AX_MID_X,_=AX_MID_Y,I=.03*AX_WIDTH,c=.03*AX_HEIGHT,{x:l,y:d,dx:X,dy:x}=transAxisToCanvas({x:T,y:_,dx:I,dy:c}),u=Math.min(X,x);AESTHETIC.configure(t.append("circle").attr("cx",l).attr("cy",d).attr("r",u),CONFIG.trainLightSource);const f=u/2,N=transAxisToCanvas({dx:axDistTraveled({fracOfC:1})}).dx,p=[{x0:l,x1:l-N},{x0:l,x1:l+N}];return AESTHETIC.configure(t.selectAll().data(p).enter().append("circle").attr("cx",t=>t.x0).attr("cy",d).attr("r",f),CONFIG.trainPhoton)}function addTracks(t){const a=AX_MIN_X+.05*AX_WIDTH,n=AX_MAX_X-.05*AX_WIDTH,e=AX_MIN_Y+.05*AX_HEIGHT,i=AX_MAX_Y-.05*AX_HEIGHT,r=CONFIG.nTiesVisible*CONFIG.trainWidthProptn/TRAIN_WIDTH_PROPTN*(AX_MAX_X-AX_MIN_X)/(n-a),{axDistBtwnTies:o,initialTieAxX:s}=getRailroadTieParams({trackInteriorAxMinX:a,trackInteriorAxMaxX:n,nTiesVisible:r}),A=Math.ceil(r+axDistTraveled({fracOfC:CONFIG.maxTrainSpeed})/o),T=[];for(let t=0;t<A;t++){const a=s+t*o,[n,e]=[{x:a,y:AX_MIN_Y},{x:a,y:AX_MAX_Y}].map(transAxisToCanvas);T.push({p1:n,p2:e,baseX:n.x})}const _=AESTHETIC.configure(t.selectAll().data(T).enter().append("line").attr("x1",x1).attr("y1",y1).attr("x2",x2).attr("y2",y2),CONFIG.railroadTie),I=[];return[e,i].forEach(t=>{const[a,n]=[{x:AX_MIN_X,y:t},{x:AX_MAX_X,y:t}].map(transAxisToCanvas);I.push({p1:a,p2:n})}),{ties:_,rails:AESTHETIC.configure(t.selectAll().data(I).enter().append("line").attr("x1",x1).attr("y1",y1).attr("x2",x2).attr("y2",y2),CONFIG.railroadRail)}}const trackLines=addTracks(canvas),photons=addTrainAndLightSources(canvas),playbackInfo={animationIsPlaying:!1,animationStartDate:null,animationTimer:null,beginButton:document.getElementById("btn-run-animation"),resetButton:document.getElementById("btn-reset-animation")};function beginAnimation(){if(playbackInfo.animationIsPlaying)return;playbackInfo.animationIsPlaying=!0,playbackInfo.animationStartDate=new Date,playbackInfo.beginButton.disabled=!0,playbackInfo.resetButton.disabled=!1,playbackInfo.animationTimer=setTimeout(()=>{playbackInfo.animationIsPlaying=!1,playbackInfo.animationEndDate=new Date},TOTAL_DURATION_MS);const t=transAxisToCanvas({dx:axDistTraveled({fracOfC:USER_INFO.trainSpeed})}).dx;trackLines.ties.transition().duration(0).attr("x1",t=>t.baseX).attr("x2",t=>t.baseX).transition().duration(TOTAL_DURATION_MS).ease(d3.easeLinear).attr("x1",a=>a.baseX-t).attr("x2",a=>a.baseX-t),photons.transition().duration(0).attr("cx",t=>t.x0).transition().duration(TOTAL_DURATION_MS).ease(d3.easeLinear).attr("cx",t=>t.x1)}function stopAnimation(){playbackInfo.animationIsPlaying=!1,clearTimeout(playbackInfo.animationTimer),playbackInfo.beginButton.disabled=!1,playbackInfo.resetButton.disabled=!0;const t=(new Date).getTime()-playbackInfo.animationStartDate.getTime(),a=AESTHETIC.easingForAnimationReset,n=AESTHETIC.durationMSOfAnimationReset*Math.min(1,.5*(1+t/TOTAL_DURATION_MS));trackLines.ties.transition().duration(n).ease(a).attr("x1",t=>t.baseX).attr("x2",t=>t.baseX),photons.transition().duration(n).ease(a).attr("cx",t=>t.x0)}updateTrainSpeed(0,{initial:!0});</script></body>
</html>