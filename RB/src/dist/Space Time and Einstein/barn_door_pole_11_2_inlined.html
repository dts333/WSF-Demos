<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body><style>body{max-width:800px;margin:50px auto;padding:0;background-color:#000;color:#fff;font-size:21px;font-family:sans-serif}.play-button{margin-top:1.5em;margin-bottom:1em;width:5em;font-size:15px}.slider-label{margin-right:1em;display:inline-block}.div-below-slider{padding-top:10px}.highlighted-text{color:#5df}.viz-canvas{padding-top:1em}.sci-num{padding-right:.15em}.eqn-left{text-align:right}.eqn-middle{padding-left:.25em;padding-right:.25em}.eqn-right{text-align:left}input[type=range]{-webkit-appearance:none;-moz-apperance:none;width:40%;height:8px;padding:0 0;background:#8b8f92;border-radius:2px;margin-top:25px;position:relative;bottom:4px}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;-moz-apperance:none;width:25px;height:25px;-webkit-border-radius:20px;-moz-border-radius:20px;-ms-border-radius:20px;-o-border-radius:20px;border-radius:20px;background-image:-webkit-gradient(linear,left top,left bottom,color-stop(0,#fefefe),color-stop(.49,#d7d7d7),color-stop(.51,#d1d1d1),color-stop(1,#c8c8c8));border:1px solid #787878}input[type=range]::-moz-range-thumb{box-shadow:1px 1px 1px #000,0 0 1px #0d0d0d;border:1px solid #000;height:20px;width:20px;border-radius:20px;background:#fff;cursor:pointer}input[type=range]::-ms-thumb{box-shadow:1px 1px 1px #000,0 0 1px #0d0d0d;border:1px solid #000;height:20px;width:20px;border-radius:20px;background:#fff;cursor:pointer}</style>
<div>
<span>
<label>
<span class="slider-label">Relative speed:</span>
<input id="input-relative-speed" max="0.95" min="0.0" name="input-relative-speed" oninput="updateRelativeSpeed(this.value)" step=".05" type="range" value="0"/>
</label>
</span>
<div class="div-below-slider" id="div-speed-info">
<span class="eqn-left">ùë£</span><span class="eqn-middle">=</span><span class="sci-num highlighted-text eqn-right" id="relative-speed-text">0.1</span>ùëê
</div>
</div>
<div>
<p id="barn-pole-rest-length">
Rest length of barn: <span class="sci-num">6.00</span>m<br/>
Rest length of pole: <span class="sci-num">9.00</span>m
</p>
</div>
<div>
<span>
<span>Barn's Perspective</span>
<button class="play-button" id="btn-run-animation-barn-perspective" onclick="beginAnimation(bothPlaybackInfo.barnStationary)">
Start
</button>
<button class="play-button" disabled="" id="btn-reset-animation-barn-perspective" onclick="stopAnimation(bothPlaybackInfo.barnStationary)">
Reset
</button>
</span>
<br/>
<span>Contracted length of pole:
<span class="sci-num highlighted-text" id="text-contracted-length-pole">5</span>m
</span>
</div>
<svg class="viz-canvas" id="canvas-barn-perspective" style="margin: 0 auto; display: block;" xmlns="http://www.w3.org/2000/svg"></svg>
<br/>
<div>
<span>
<span>Pole's Perspective</span>
<button class="play-button" id="btn-run-animation-pole-perspective" onclick="beginAnimation(bothPlaybackInfo.poleStationary)">
Start
</button>
<button class="play-button" disabled="" id="btn-reset-animation-pole-perspective" onclick="stopAnimation(bothPlaybackInfo.poleStationary)">
Reset
</button>
</span>
<br/>
<span>Contracted length of barn:
<span class="sci-num highlighted-text" id="text-contracted-length-barn">5</span>m
</span>
</div>
<svg class="viz-canvas" id="canvas-pole-perspective" style="margin: 0 auto; display: block;" xmlns="http://www.w3.org/2000/svg"></svg>
<script type="text/javascript">"use strict";const C=299792458;function isIterable(t){return null!=t&&"function"==typeof t[Symbol.iterator]}function applyDatum(t,{transition:e}={}){const a=d3.select(this);a.classed(t.class,!0);const n=void 0===e?a:a.transition(e);Object.entries(t.attrs).forEach(([t,e])=>{n.attr(t,e)}),"text"in t&&n.text(t.text)}function _addGraphicalObjs(t,e){return t.selectAll().data(e).enter().append(t=>d3.create(`svg:${t.shape}`).node()).each(applyDatum)}function applyGraphicalObjs(t,e,{selector:a,cssClass:n,transition:r}){return t.selectAll(a).data(e).join(t=>t.append(t=>d3.create(`svg:${t.shape}`).node())).each(function(t){applyDatum.call(this,t,{transition:r})}).classed(n,!0)}function lorentzFactor({fracOfC:t}){return t||(t=0),1/Math.sqrt(1-t*t)}function sign(t,e){return void 0===e&&(e=1e-6),t<-e?-1:t<e?0:1}function l2Norm(...t){const e=t.reduce((t,e)=>t+e*e,0);return Math.sqrt(e)}const AESTHETIC={solidFill:"#4ff8",solidStroke:"#fff8",durationMSOfAnimationReset:300,easingForAnimationReset:d3.easePoly.exponent(2.5),configure:function(t,e){return Object.entries(e).forEach(([e,a])=>{if("attrs"===e){const e=a;Object.entries(e).forEach(([e,a])=>{t.attr(e,a)})}else{if("class"!==e)throw new Error(`Unexpected key ${e}`);t.classed(a,!0)}}),t}},AX_MIN_X=5,AX_MIN_Y=3,AX_MAX_X=10,AX_MAX_Y=7,AX_WIDTH=10-AX_MIN_X,AX_HEIGHT=7-AX_MIN_Y,AX_MID_Y=AX_MIN_Y+(7-AX_MIN_Y)/2,POLE_PHYSICAL_SIZE=9,BARN_PHYSICAL_SIZE=6,POLE_BARN_RATIO=1.5,BARN_WIDTH_PROPTN=.16,BARN_HEIGHT_PROPTN=.8,POLE_WIDTH_PROPTN=.24,AX_STARTPOINT_RATIO=.37,ANIMATION_AX_ENDPOINT=.13,AX_BARN_WIDTH=.16*AX_WIDTH,AX_BARN_HEIGHT=.8*AX_HEIGHT,AX_POLE_WIDTH=.24*AX_WIDTH,TIME_FOR_LIGHT_TO_TRAVERSE_SEC=2,TIME_FOR_LIGHT_TO_TRAVERSE_MS=2e3,CANVAS_WIDTH=800,CANVAS_HEIGHT=100,ANIMATION_STATE={hasNotYetStarted:0,isPlaying:1,hasFinishedPlaying:2},BARN_DOOR_HEIGHT_PROPTN=.5,BARN_DOOR_OFFSET=8,USER_INFO={relativeSpeed:.1},canvas=d3.selectAll(".viz-canvas").attr("width",800).attr("height",100).attr("background-color","black"),subcanvases=canvas.data([{originX:0,originY:0,width:800,height:100,observerIsStandingOn:"barn"},{originX:0,originY:0,width:800,height:100,observerIsStandingOn:"pole"}]).each(function(t){d3.select(this).append("g").attr("transform",`translate(0, ${t.originY})`).classed("subcanvas",!0)}).selectAll("g");function apparentWidthsMeters({fracOfC:t}){const e=lorentzFactor({fracOfC:t});return{barn:BARN_PHYSICAL_SIZE/e,pole:POLE_PHYSICAL_SIZE/e}}const speedInputSlider=document.getElementById("input-relative-speed"),speedTextSpan=document.getElementById("relative-speed-text");function getSpeed(t){t=void 0!==t?t:speedInputSlider.value;const e=parseFloat(t);if(e<0||e>1)throw new Error(`Got invalid speed (outside [0,1]): ${e}`);return e}function transAxisToCanvas(t,{x:e,y:a,dx:n,dy:r}){const s={x:e,y:a,dx:n,dy:r},o={},i={};Object.entries(s).forEach(([t,e])=>{const a=isIterable(e);o[t]=a,i[t]=a?e:[e]});const c={};Object.entries(i).forEach(([e,a])=>{let n;switch(e){case"x":n=(e=>(e-AX_MIN_X)/AX_WIDTH*t.width);break;case"y":n=(e=>(e-AX_MIN_Y)/AX_HEIGHT*t.height);break;case"dx":n=(e=>t.width/AX_WIDTH*e);break;case"dy":n=(e=>t.height/AX_HEIGHT*e);break;default:throw new Error(`Unexpected case ${e}`)}c[e]=a.map(n)});const d={};return Object.entries(c).forEach(([t,e])=>{d[t]=o[t]?e:e[0]}),d}function _getBarnData(t,{fracOfC:e,progress:a=0}={}){"barn"===t.observerIsStandingOn&&(e=0),"barn"===t.observerIsStandingOn&&(a=0);const n=lorentzFactor({fracOfC:e}),r=(1-a)*(AX_MIN_X+AX_STARTPOINT_RATIO*AX_WIDTH)+a*(AX_MIN_X+(1-ANIMATION_AX_ENDPOINT)*AX_WIDTH),s=r-.5*AX_BARN_WIDTH/n,o=AX_MID_Y-.5*AX_BARN_HEIGHT,i=BARN_DOOR_HEIGHT_PROPTN*AX_BARN_HEIGHT,c=(AX_BARN_HEIGHT-i)/2,{x:[d,l],y:_,dx:A,dy:[I,u,T]}=transAxisToCanvas(t,{x:[r,s],y:o,dx:AX_BARN_WIDTH/n,dy:[AX_BARN_HEIGHT,i,c]}),p=[A+T,u,T+A+T,u,T+100].join(" ");return[{class:"barn",canvas:t,shape:"rect",midX:d,attrs:{x:l,y:_,width:A,height:I,fill:AESTHETIC.solidFill,stroke:"white","stroke-width":5,"stroke-linecap":"square","stroke-dasharray":p}}]}function _getPoleData(t,{fracOfC:e,progress:a=0}={}){"pole"===t.observerIsStandingOn&&(e=0),"pole"===t.observerIsStandingOn&&(a=0);const n=lorentzFactor({fracOfC:e}),r=(1-a)*(AX_MIN_X+(1-AX_STARTPOINT_RATIO)*AX_WIDTH)+a*(AX_MIN_X+ANIMATION_AX_ENDPOINT*AX_WIDTH),s=r-.5*AX_POLE_WIDTH/n,o=r+.5*AX_POLE_WIDTH/n,i=AX_MID_Y,{x:[c,d,l],y:_}=transAxisToCanvas(t,{x:[s,r,o],y:i});return[{class:"pole",canvas:t,shape:"line",midX:d,attrs:{x1:c,y1:_,x2:l,y2:_,stroke:"white","stroke-width":5}}]}function _getBarnDoorsData(t,{fracOfC:e,progress:a=0,barnData:n,poleData:r}={}){const s=n?n[0]:_getBarnData(t,{fracOfC:e,progress:a})[0],o=r?r[0]:_getPoleData(t,{fracOfC:e,progress:a})[0],{x:i,y:c,width:d,height:l}=s.attrs,_=l*BARN_DOOR_HEIGHT_PROPTN,A=c+(l-_)/2,I=A+_,u={class:"barn-door",barn:s,shape:"line",closed:{y1:A,y2:I},open:{y1:I,y2:I+_}},T={stroke:"white","stroke-width":4},p=i-BARN_DOOR_OFFSET,O=i+d+BARN_DOOR_OFFSET,f=o.attrs.x2<p||o.attrs.x1>p,b=o.attrs.x1>O||o.attrs.x2<O,N=({y1:t,y2:e})=>({y1:t,y2:e}),h=N(f?u.closed:u.open),S=N(b?u.closed:u.open);return[{...u,baseX:p,side:"left",isOpen:!f,attrs:{x1:p,x2:p,...h,...T}},{...u,baseX:O,side:"right",isOpen:!b,attrs:{x1:O,x2:O,...S,...T}}]}function _getBarnAndPoleData(t,{progress:e=0}={}){const a=getSpeed(),n=_getBarnData(t,{fracOfC:a,progress:e}),r=_getBarnDoorsData(t,{fracOfC:a,progress:e}),s=_getPoleData(t,{fracOfC:a,progress:e});return{objects:{barnData:n,barnDoorsData:r,poleData:s},data:[...n,...r,...s]}}function addBarnsAndPoles(t){return _addGraphicalObjs(t,t=>_getBarnAndPoleData(t).data)}addBarnsAndPoles(subcanvases);const bothPlaybackInfo={barnStationary:{stationary:"barn",animationState:ANIMATION_STATE.hasNotYetStarted,animationStartDate:null,animationTimer:null,beginButton:document.getElementById("btn-run-animation-barn-perspective"),resetButton:document.getElementById("btn-reset-animation-barn-perspective")},poleStationary:{stationary:"pole",animationState:ANIMATION_STATE.hasNotYetStarted,animationStartDate:null,animationTimer:null,beginButton:document.getElementById("btn-run-animation-pole-perspective"),resetButton:document.getElementById("btn-reset-animation-pole-perspective")}};function updateRelativeSpeed(t,{fromUserInput:e=!0}={}){try{const a=getSpeed(t);USER_INFO.trainSpeed=a,(t||0===t)&&(speedTextSpan.textContent=(+t).toFixed(2)),e&&(document.getElementById("div-speed-info").style.visibility="visible"),[bothPlaybackInfo.barnStationary,bothPlaybackInfo.poleStationary].forEach(t=>{t.animationState===ANIMATION_STATE.hasNotYetStarted&&(t.beginButton.disabled=0===a)});const n=".barn",r=".pole",{barn:s,pole:o}=apparentWidthsMeters({fracOfC:a});subcanvases.each(function(t){let e,i,c,d,l,_,A,I;const u=d3.select(this);switch("barn"===t.observerIsStandingOn?(e=n,i=r,d=_getBarnData,c=_getPoleData,l=bothPlaybackInfo.barnStationary,_="text-contracted-length-pole",A=o):(e=r,i=n,d=_getPoleData,c=_getBarnData,l=bothPlaybackInfo.poleStationary,_="text-contracted-length-barn",A=s),l.animationState){case ANIMATION_STATE.hasNotYetStarted:I=0;break;case ANIMATION_STATE.isPlaying:return;case ANIMATION_STATE.hasFinishedPlaying:I=1;break;default:throw new Error(`Unexpect case ${l.animationState}`)}const T={[e]:d(t,{fracOfC:a,progress:I}),[i]:c(t,{fracOfC:a,progress:I})};T[".barn-door"]=_getBarnDoorsData(t,{barnData:T[n],poleData:T[r]}),document.getElementById(_).textContent=A.toFixed(2),Object.entries(T).forEach(([t,e])=>{u.selectAll(t).data(e).each(function(t){const e=d3.select(this).transition().duration(100).ease(d3.easeCubicOut);Object.entries(t.attrs).forEach(([t,a])=>{e.attr(t,a)})})})})}catch(e){throw console.log(t),e}}function getDurationMS(t){return TIME_FOR_LIGHT_TO_TRAVERSE_MS/t}function beginAnimation(t){if(updateRelativeSpeed(),t.animationIsPlaying)return;const e=getSpeed();if(0===e)return;const a=getDurationMS(e);t.animationState=ANIMATION_STATE.isPlaying,t.animationStartDate=new Date,t.beginButton.disabled=!0,t.resetButton.disabled=!1,t.animationTimer=setTimeout(()=>{t.animationEndDate=new Date,t.animationState=ANIMATION_STATE.hasFinishedPlaying,updateRelativeSpeed()},a);const n=t.stationary,r=d3.easeLinear,s=".pole",o={".barn":t=>t.attrs.width,[s]:t=>t.attrs.x2-t.attrs.x1},i={".barn":1-ANIMATION_AX_ENDPOINT,[s]:ANIMATION_AX_ENDPOINT},c={".barn":({datum:t,minCanvasXf:e})=>e-t.attrs.x,[s]:({datum:t,minCanvasXf:e})=>t.attrs.x1-e};subcanvases.filter(t=>t.observerIsStandingOn===n).each(function(t){const n=d3.select(this),d="barn"===t.observerIsStandingOn,l=d?s:".barn",_=d3.select(n.selectAll(l).node()),A=_.datum(),I=o[l](A),u=transAxisToCanvas(t,{x:AX_MIN_X+i[l]*AX_WIDTH}).x-I/2,T=c[l]({datum:A,minCanvasXf:u});let p,O,f;if(d){const t=u,e=u+I;_.transition().duration(0).attr("x1",A.attrs.x1).attr("x2",A.attrs.x2).transition().duration(a).ease(r).attr("x1",t).attr("x2",e),p={x1:t,x2:e},O=A,f=(t=>t)}else _.transition().duration(0).attr("x",A.attrs.x).transition().duration(a).ease(r).attr("x",u),O=d3.select(n.selectAll(s).node()).datum(),p={x1:O.attrs.x1,x2:O.attrs.x2},f=(t=>t+T);n.selectAll(".barn-door").each(function(t){const n=d3.select(this),r=t.baseX,s=O.attrs.x1-r-3*BARN_DOOR_OFFSET*e,o=O.attrs.x2-r-("left"===t.side?1:2)*BARN_DOOR_OFFSET*e,i={enter:s/T,leave:o/T},c=150/a,l=f(r),_=p.x1<=l&&l<=p.x2,A=function(e){const a=t.closed[e],n=t.open[e],r=d3.interpolateNumber(a,n),s=i.leave<1?d3.easeCubicInOut:d3.easeCubicIn,o=i.enter,d=i.leave;return function(){return t=>{if(t<o)return a;if(t<o+c){const e=(t-o)/c;return r(d3.easeCubicInOut(e))}if(t<d||_)return n;if(t<d+c){return r(s(1-(t-d)/c))}return a}}},I=n.transition().duration(0).attr("x1",r).attr("x2",r).transition().duration(a).ease(d3.easeLinear).attrTween("y1",A("y1")).attrTween("y2",A("y2"));if(!d){const t=function(){return d3.interpolateNumber(r,r+T)};I.attrTween("x1",t).attrTween("x2",t)}I.transition().duration(100).ease(d3.easeCubicOut).attr("y1",_?t.open.y1:t.closed.y1).attr("y2",_?t.open.y2:t.closed.y2)})})}function stopAnimation(t){t.animationState=ANIMATION_STATE.hasNotYetStarted,clearTimeout(t.animationTimer),t.beginButton.disabled=!1,t.resetButton.disabled=!0,updateRelativeSpeed()}updateRelativeSpeed(0,{fromUserInput:!1});</script></body>
</html>