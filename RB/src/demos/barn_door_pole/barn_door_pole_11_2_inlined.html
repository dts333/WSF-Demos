<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<script src="https://d3js.org/d3.v5.min.js">
</script>
</head>
<body>
<style>
body{max-width:800px;margin:50px auto;padding:0;background-color:#000;color:#fff;font-size:21px;font-family:sans-serif}.play-button{margin-top:1.5em;margin-bottom:1em;width:5em;font-size:15px}.highlighted-text{color:#5df}.viz-canvas{padding-top:1em}input[type=range]{-webkit-appearance:none;-moz-apperance:none;width:40%;height:8px;padding:0 0;background:#8b8f92;border-radius:2px;margin-top:25px}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;-moz-apperance:none;width:25px;height:25px;-webkit-border-radius:20px;-moz-border-radius:20px;-ms-border-radius:20px;-o-border-radius:20px;border-radius:20px;background-image:-webkit-gradient(linear,left top,left bottom,color-stop(0,#fefefe),color-stop(.49,#d7d7d7),color-stop(.51,#d1d1d1),color-stop(1,#c8c8c8));border:1px solid #787878}input[type=range]::-moz-range-thumb{box-shadow:1px 1px 1px #000,0 0 1px #0d0d0d;border:1px solid #000;height:20px;width:20px;border-radius:20px;background:#fff;cursor:pointer}input[type=range]::-ms-thumb{box-shadow:1px 1px 1px #000,0 0 1px #0d0d0d;border:1px solid #000;height:20px;width:20px;border-radius:20px;background:#fff;cursor:pointer}
</style>
<div>
<span>
<label>
Relative speed (as fraction of ùëê):
<span class="highlighted-text" id="relative-speed-text" style="min-width: 3em; display: inline-block;">
</span>
<input id="input-relative-speed" max="0.95" min="0.5" name="input-relative-speed" oninput="updateRelativeSpeed(this.value)" step=".05" type="range" value=".75"/>
</label>
</span>
</div>
<div>
<span id="barn-rest-length">
Rest length of barn: 6.00m
</span>
<br/>
<span id="pole-rest-length">
Rest length of pole: 9.00m
</span>
</div>
<br/>
<div>
<span>
<span>
Barn's Perspective
</span>
<button class="play-button" id="btn-run-animation-barn-perspective" onclick="beginAnimation(bothPlaybackInfo.barnStationary)">
Start
</button>
<button class="play-button" disabled="" id="btn-reset-animation-barn-perspective" onclick="stopAnimation(bothPlaybackInfo.barnStationary)">
Reset
</button>
</span>
<br/>
<span>
Contracted length of pole:
<span class="highlighted-text" id="text-contracted-length-pole">
5
</span>
m
</span>
</div>
<svg class="viz-canvas" id="canvas-barn-perspective" style="margin: 0 auto; display: block;" xmlns="http://www.w3.org/2000/svg">
</svg>
<br/>
<div>
<span>
<span>
Pole's Perspective
</span>
<button class="play-button" id="btn-run-animation-pole-perspective" onclick="beginAnimation(bothPlaybackInfo.poleStationary)">
Start
</button>
<button class="play-button" disabled="" id="btn-reset-animation-pole-perspective" onclick="stopAnimation(bothPlaybackInfo.poleStationary)">
Reset
</button>
</span>
<br/>
<span>
Contracted length of barn:
<span class="highlighted-text" id="text-contracted-length-barn">
5
</span>
m
</span>
</div>
<svg class="viz-canvas" id="canvas-pole-perspective" style="margin: 0 auto; display: block;" xmlns="http://www.w3.org/2000/svg">
</svg>
<script type="text/javascript">
"use strict";function isIterable(t){return null!=t&&"function"==typeof t[Symbol.iterator]}function _addGraphicalObjs(t,e){return t.selectAll().data(e).enter().append(t=>d3.create(`svg:${t.shape}`).node()).each(function(t){const e=d3.select(this).classed(t.class,!0);Object.entries(t.attrs).forEach(([t,a])=>{e.attr(t,a)})})}function lorentzFactor({fracOfC:t}){return t||(t=0),1/Math.sqrt(1-t*t)}const AESTHETIC={solidFill:"#4ff8",solidStroke:"#fff8",durationMSOfAnimationReset:300,easingForAnimationReset:d3.easePoly.exponent(2.5),configure:function(t,e){return Object.entries(e).forEach(([e,a])=>{if("attrs"===e){const e=a;Object.entries(e).forEach((e,a)=>{t.attr(e,a)})}else{if("class"!==e)throw new Error(`Unexpected key ${e}`);t.classed(a,!0)}}),t}},AX_MIN_X=5,AX_MIN_Y=3,AX_MAX_X=10,AX_MAX_Y=7,AX_WIDTH=10-AX_MIN_X,AX_HEIGHT=7-AX_MIN_Y,AX_MID_X=AX_MIN_X+(10-AX_MIN_X)/2,AX_MID_Y=AX_MIN_Y+(7-AX_MIN_Y)/2,POLE_PHYSICAL_SIZE=9,BARN_PHYSICAL_SIZE=6,POLE_BARN_RATIO=1.5,BARN_WIDTH_PROPTN=.2,BARN_HEIGHT_PROPTN=.8,POLE_WIDTH_PROPTN=.2*1.5,AX_BARN_WIDTH=.2*AX_WIDTH,AX_BARN_HEIGHT=.8*AX_HEIGHT,AX_POLE_WIDTH=AX_WIDTH*(.2*1.5),TIME_FOR_LIGHT_TO_TRAVERSE_SEC=2,TIME_FOR_LIGHT_TO_TRAVERSE_MS=2e3,CANVAS_WIDTH=800,CANVAS_HEIGHT=100,BARN_DOOR_HEIGHT_PROPTN=.5,BARN_DOOR_OFFSET=8,USER_INFO={relativeSpeed:.1},canvas=d3.selectAll(".viz-canvas").attr("width",800).attr("height",100).attr("background-color","black"),subcanvases=canvas.data([{originX:0,originY:0,width:800,height:100,observerIsStandingOn:"barn"},{originX:0,originY:0,width:800,height:100,observerIsStandingOn:"pole"}]).each(function(t){d3.select(this).append("g").attr("transform",`translate(0, ${t.originY})`).classed("subcanvas",!0)}).selectAll("g");function apparentWidthsMeters({fracOfC:t}){const e=lorentzFactor({fracOfC:t});return{barn:BARN_PHYSICAL_SIZE/e,pole:POLE_PHYSICAL_SIZE/e}}const speedInputSlider=document.getElementById("input-relative-speed"),speedTextSpan=document.getElementById("relative-speed-text");function getSpeed(t){t=void 0!==t?t:speedInputSlider.value;const e=parseFloat(t);if(e<0||e>1)throw new Error(`Got invalid speed (outside [0,1]): ${e}`);return e}function transAxisToCanvas(t,{x:e,y:a,dx:n,dy:r}){const s=isIterable(e)?e:[e],o=isIterable(a)?a:[a],i=isIterable(n)?n:[n],c=isIterable(r)?r:[r],d=s.map(t=>(t-AX_MIN_X)/AX_WIDTH),l=o.map(t=>(t-AX_MIN_Y)/AX_HEIGHT),_=d.map(e=>e*t.width),u=l.map(e=>e*t.height),A=i.map(e=>t.width/AX_WIDTH*e),I=c.map(e=>t.height/AX_HEIGHT*e);return{x:isIterable(e)?_:_[0],y:isIterable(a)?u:u[0],dx:isIterable(n)?A:A[0],dy:isIterable(r)?I:I[0]}}function _getBarnData(t,{fracOfC:e}){"barn"===t.observerIsStandingOn&&(e=0);const a=lorentzFactor({fracOfC:e}),n=AX_MIN_X+1/3*AX_WIDTH,r=n-.5*AX_BARN_WIDTH/a,s=AX_MID_Y-.5*AX_BARN_HEIGHT,o=BARN_DOOR_HEIGHT_PROPTN*AX_BARN_HEIGHT,i=(AX_BARN_HEIGHT-o)/2,{x:[c,d],y:l,dx:_,dy:[u,A,I]}=transAxisToCanvas(t,{x:[n,r],y:s,dx:AX_BARN_WIDTH/a,dy:[AX_BARN_HEIGHT,o,i]}),f=[_+I,A,I+_+I,A,I+100].join(" ");return[{class:"barn",canvas:t,shape:"rect",midX:c,attrs:{x:d,y:l,width:_,height:u,fill:AESTHETIC.solidFill,stroke:"white","stroke-width":5,"stroke-linecap":"square","stroke-dasharray":f}}]}function _getPoleData(t,{fracOfC:e}){"pole"===t.observerIsStandingOn&&(e=0);const a=lorentzFactor({fracOfC:e}),n=AX_MIN_X+2/3*AX_WIDTH,r=n-.5*AX_POLE_WIDTH/a,s=n+.5*AX_POLE_WIDTH/a,o=AX_MID_Y,{x:[i,c,d],y:l}=transAxisToCanvas(t,{x:[r,n,s],y:o});return[{class:"pole",canvas:t,shape:"line",midX:c,attrs:{x1:i,y1:l,x2:d,y2:l,stroke:"white","stroke-width":5}}]}function _getBarnDoorsData(t){const{x:e,y:a,width:n,height:r}=t.attrs,s=r*BARN_DOOR_HEIGHT_PROPTN,o=a+(r-s)/2,i=o+s,c={class:"barn-door",barn:t,shape:"line",closed:{y1:o,y2:i},open:{y1:i,y2:i+s}},d={stroke:"white","stroke-width":4},l=e-BARN_DOOR_OFFSET,_=e+n+BARN_DOOR_OFFSET;return[{...c,baseX:l,side:"left",attrs:{x1:l,y1:c.closed.y1,x2:l,y2:c.closed.y2,...d}},{...c,baseX:_,side:"right",attrs:{x1:_,y1:c.closed.y1,x2:_,y2:c.closed.y2,...d}}]}function _getBarnAndPoleData(t){const e=getSpeed(),a=_getBarnData(t,{fracOfC:e}),n=_getBarnDoorsData(a[0]),r=_getPoleData(t,{fracOfC:e});return{objects:{barnData:a,barnDoorsData:n,poleData:r},data:[...a,...n,...r]}}function addBarnsAndPoles(t){return _addGraphicalObjs(t,t=>_getBarnAndPoleData(t).data)}addBarnsAndPoles(subcanvases);const bothPlaybackInfo={barnStationary:{stationary:"barn",frozen:!1,animationIsPlaying:!1,animationStartDate:null,animationTimer:null,beginButton:document.getElementById("btn-run-animation-barn-perspective"),resetButton:document.getElementById("btn-reset-animation-barn-perspective")},poleStationary:{stationary:"pole",frozen:!1,animationIsPlaying:!1,animationStartDate:null,animationTimer:null,beginButton:document.getElementById("btn-run-animation-pole-perspective"),resetButton:document.getElementById("btn-reset-animation-pole-perspective")}};function updateRelativeSpeed(t){try{const e=getSpeed(t);USER_INFO.trainSpeed=e,t&&(speedTextSpan.textContent=t);const{barn:a,pole:n}=apparentWidthsMeters({fracOfC:e});subcanvases.each(function(t){const{barnData:e,barnDoorsData:r,poleData:s}=_getBarnAndPoleData(t).objects,o=d3.select(this);if("barn"===t.observerIsStandingOn){if(bothPlaybackInfo.barnStationary.frozen)return;document.getElementById("text-contracted-length-pole").textContent=n.toFixed(2)}else{if(bothPlaybackInfo.poleStationary.frozen)return;document.getElementById("text-contracted-length-barn").textContent=a.toFixed(2)}const i={".barn":e,".pole":s,".barn-door":r};Object.entries(i).forEach(([t,e])=>{o.selectAll(t).data(e).each(function(t){const e=d3.select(this).transition().duration(100).ease(d3.easeCubicOut);Object.entries(t.attrs).forEach(([t,a])=>{e.attr(t,a)})})})})}catch(e){throw console.log(t),e}}function getDurationMS(t){return TIME_FOR_LIGHT_TO_TRAVERSE_MS/t}function beginAnimation(t){if(updateRelativeSpeed(),t.animationIsPlaying)return;const e=getSpeed(),a=getDurationMS(e);t.animationIsPlaying=!0,t.animationStartDate=new Date,t.beginButton.disabled=!0,t.resetButton.disabled=!1,t.frozen=!0,t.animationTimer=setTimeout(()=>{t.animationIsPlaying=!1,t.animationEndDate=new Date},a);const n=t.stationary,r=d3.easeLinear,s=lorentzFactor({fracOfC:e});subcanvases.filter(t=>t.observerIsStandingOn===n).each(function(t){const o=d3.select(this);if("barn"===n){const n=o.selectAll(".pole"),i=_getPoleData(t,{fracOfC:e});n.data(i).each(function(t){const n=d3.select(this),i=AX_POLE_WIDTH/s,c=AX_MIN_X+.1*AX_WIDTH,{x:d,dx:l}=transAxisToCanvas(t.canvas,{x:c,dx:i}),_=d-l/2,u=_+l,A=t.attrs.x1-_;n.transition().duration(0).attr("x1",t.attrs.x1).attr("x2",t.attrs.x2).transition().duration(a).ease(r).attr("x1",_).attr("x2",u),o.selectAll(".barn-door").each(function(n){const r=d3.select(this),s=t.attrs.x1-n.baseX-2*BARN_DOOR_OFFSET*e,o=t.attrs.x2-n.baseX-6*BARN_DOOR_OFFSET*e,i={enter:a*(s/A),leave:a*(o/A)},c=r.transition().delay(i.enter).duration(150).ease(d3.easeCubicInOut).attr("y1",n.open.y1).attr("y2",n.open.y2);t.attrs.x2-n.baseX<=A&&c.transition().delay(i.leave-i.enter).duration(150).ease(d3.easeCubicInOut).attr("y1",n.closed.y1).attr("y2",n.closed.y2),console.log(i)})})}else{const n=o.selectAll(".barn"),i=_getBarnData(t,{fracOfC:e});n.data(i).each(function(t){const n=d3.select(this),i=AX_BARN_WIDTH/s,c=AX_MIN_X+.9*AX_WIDTH,{x:d,dx:l}=transAxisToCanvas(t.canvas,{x:c,dx:i}),_=d-l/2,u=_-t.attrs.x;n.transition().duration(0).attr("x",t.attrs.x).transition().duration(a).ease(r).attr("x",_),o.selectAll(".barn-door").each(function(t){const n=d3.select(this),r=t.baseX;o.selectAll(".pole").each(s=>{const o=s.attrs.x1-r-3*BARN_DOOR_OFFSET*e,i=s.attrs.x2-r-("left"===t.side?1:2)*BARN_DOOR_OFFSET*e,c=o/u,d=i/u,l=150/a,_=function(){const t=d3.interpolateNumber(r,r+u);return function(e){return t(d3.easeLinear(e))}},A=function(e){return function(){const a=t.closed[e],n=t.open[e],r=d3.interpolateNumber(a,n),s=d<1?d3.easeCubicInOut:d3.easeCubicIn;return t=>{if(t<c)return a;if(t<c+l){const e=(t-c)/l;return r(d3.easeCubicInOut(e))}if(t<d)return n;if(t<d+l){return r(s(1-(t-d)/l))}return a}}};n.transition().duration(0).attr("x1",r).attr("x2",r).transition().duration(a).ease(d3.easeLinear).attrTween("x1",_).attrTween("x2",_).attrTween("y1",A("y1")).attrTween("y2",A("y2")).transition().duration(100).ease(d3.easeCubicOut).attr("y1",d<1?t.closed.y1:t.open.y1).attr("y2",d<1?t.closed.y2:t.open.y2)})})})}})}function stopAnimation(t){t.frozen=!1,t.animationIsPlaying=!1,clearTimeout(t.animationTimer),t.beginButton.disabled=!1,t.resetButton.disabled=!0;const e=(new Date).getTime()-t.animationStartDate.getTime(),a=t.stationary,n=getSpeed(),r=AESTHETIC.easingForAnimationReset,s=AESTHETIC.durationMSOfAnimationReset*Math.min(1,.5*(1+e/getDurationMS(n)));subcanvases.filter(t=>t.observerIsStandingOn===a).each(function(t){const e=d3.select(this);if("barn"===a){const a=e.selectAll(".pole"),o=_getPoleData(t,{fracOfC:n});a.data(o).each(function(t){d3.select(this).transition().duration(s).ease(r).attr("x1",t.attrs.x1).attr("x2",t.attrs.x2).on("end",updateRelativeSpeed())})}else{const a=e.selectAll(".barn"),o=_getBarnData(t,{fracOfC:n});a.data(o).each(function(t){d3.select(this).transition().duration(s).ease(r).attr("x",t.attrs.x).on("end",updateRelativeSpeed())})}})}updateRelativeSpeed(.75);
</script>
</body>
</html>