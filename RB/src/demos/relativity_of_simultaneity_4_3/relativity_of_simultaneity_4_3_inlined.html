<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<script src="https://d3js.org/d3.v5.min.js">
</script>
</head>
<body>
<style>
body{max-width:800px;margin:50px auto;padding:0;background-color:#000;color:#fff;font-size:21px}.play-button{margin-top:1.5em;margin-bottom:2em;width:5em;font-size:15px}input[type=range]{-webkit-appearance:none;-moz-apperance:none;width:40%;height:8px;padding:0 0;background:#8b8f92;border-radius:2px;margin-top:25px}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;-moz-apperance:none;width:25px;height:25px;-webkit-border-radius:20px;-moz-border-radius:20px;-ms-border-radius:20px;-o-border-radius:20px;border-radius:20px;background-image:-webkit-gradient(linear,left top,left bottom,color-stop(0,#fefefe),color-stop(.49,#d7d7d7),color-stop(.51,#d1d1d1),color-stop(1,#c8c8c8));border:1px solid #787878}input[type=range]::-moz-range-thumb{box-shadow:1px 1px 1px #000,0 0 1px #0d0d0d;border:1px solid #000;height:20px;width:20px;border-radius:20px;background:#fff;cursor:pointer}input[type=range]::-ms-thumb{box-shadow:1px 1px 1px #000,0 0 1px #0d0d0d;border:1px solid #000;height:20px;width:20px;border-radius:20px;background:#fff;cursor:pointer}
</style>
<div>
<span>
<label>
Train speed (as fraction of ùëê):
<span id="train-speed-text" style="min-width: 3em; display: inline-block;">
0.1
</span>
<input id="input-train-speed" max="0.5" min="0" name="input-train-speed" oninput="updateTrainSpeed(this.value)" step=".005" type="range" value=".1"/>
</label>
</span>
</div>
<div>
<button class="play-button" id="btn-run-animation" onclick="beginAnimation()">
Start
</button>
<button class="play-button" disabled="" id="btn-reset-animation" onclick="stopAnimation()">
Reset
</button>
</div>
<svg id="canvas" style="margin: 0 auto; display: block;">
</svg>
<script type="text/javascript">
const CONFIG={durationMSOfAnimationReset:300,easingForAnimationReset:d3.easePoly.exponent(2.5),xMarginProptn:0,yMarginProptn:.15,trainWidthProptn:.4,trainHeightProptn:.6,trainSpeed:.1,trainCar:{class:"train-car",attrs:{fill:"#4ff8",stroke:"#fff8"}},trainLightSource:{class:"train-light-source",attrs:{fill:"white",stroke:"white"}},trainPhoton:{class:"train-photon",attrs:{fill:"#fff8",stroke:"white"}},railroadTie:{class:"railroad-tie",attrs:{stroke:"white","stroke-width":6}},railroadRail:{class:"railroad-rail",attrs:{stroke:"white","stroke-width":5}},canvasText:{attrs:{fill:"white","font-size":"30px","font-family":"sans-serif"}},axDistTraveledAsFracOfTrainWidth:1.2,configure:function(t,a){return Object.keys(a).forEach(n=>{const e=a[n];if("attrs"===n){const a=e;Object.keys(a).forEach(n=>{t.attr(n,a[n])})}else{if("class"!==n)throw new Error(`Unexpected key ${n}`);t.classed(e,!0)}}),t}};function toTitleCase(t){return t.replace(/\b\w+/g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})}function updateTrainSpeed(t){const a=void 0!==t?t:document.getElementById("input-train-speed").value;try{const t=Math.max(0,Math.min(parseFloat(a),1));CONFIG.trainSpeed=t,document.getElementById("train-speed-text").textContent=a}catch(t){console.log(a)}}const X_MARGIN_PROPTN=0,Y_MARGIN_PROPTN=.15,TRAIN_WIDTH_PROPTN=.75,TRAIN_HEIGHT_PROPTN=.6,AX_MIN_X=5,AX_MIN_Y=3,AX_MAX_X=10,AX_MAX_Y=7,AX_WIDTH=AX_MAX_X-AX_MIN_X,AX_HEIGHT=AX_MAX_Y-AX_MIN_Y,AX_MID_X=AX_MIN_X+(AX_MAX_X-AX_MIN_X)/2,AX_MID_Y=AX_MIN_Y+(AX_MAX_Y-AX_MIN_Y)/2,AX_TRAIN_WIDTH=.75*AX_WIDTH,AX_TRAIN_HEIGHT=.6*AX_HEIGHT,TOTAL_DURATION_SEC=3,TOTAL_DURATION_MS=3e3,CANVAS_WIDTH=800,CANVAS_HEIGHT=400,canvas=d3.select("#canvas").attr("width",CANVAS_WIDTH).attr("height",CANVAS_HEIGHT).style("background-color","black");function axDistTraveled({fracOfC:t}){return t*AX_TRAIN_WIDTH/2}function transAxisToCanvas({x:t,y:a,dx:n,dy:e}){return{x:CANVAS_WIDTH*X_MARGIN_PROPTN+(t-AX_MIN_X)/AX_WIDTH*CANVAS_WIDTH*(1-2*X_MARGIN_PROPTN),y:CANVAS_HEIGHT*Y_MARGIN_PROPTN+(a-AX_MIN_Y)/AX_HEIGHT*CANVAS_HEIGHT*(1-2*Y_MARGIN_PROPTN),dx:CANVAS_WIDTH/AX_WIDTH*n,dy:CANVAS_HEIGHT/AX_HEIGHT*e}}function x1(t){return t.p1.x}function y1(t){return t.p1.y}function x2(t){return t.p2.x}function y2(t){return t.p2.y}function addTrainAndLightSources(t){const a=AX_MID_X-AX_TRAIN_WIDTH/2,n=AX_MID_Y-AX_TRAIN_HEIGHT/2,e=a+AX_TRAIN_WIDTH,r=n+AX_TRAIN_HEIGHT,i=transAxisToCanvas({x:a,y:n}),o=transAxisToCanvas({x:e,y:r}),s=o.x-i.x,A=o.y-i.y;CONFIG.configure(t.append("rect").attr("x",i.x).attr("y",i.y).attr("width",s).attr("height",A),CONFIG.trainCar);const _=AX_MID_X,c=AX_MID_Y,I=.03*AX_WIDTH,T=.03*AX_HEIGHT,{x:l,y:d,dx:X,dy:x}=transAxisToCanvas({x:_,y:c,dx:I,dy:T}),f=Math.min(X,x);CONFIG.configure(t.append("circle").attr("cx",l).attr("cy",d).attr("r",f),CONFIG.trainLightSource);const u=f/2,N=transAxisToCanvas({dx:axDistTraveled({fracOfC:1})}).dx,y=[{x0:l,x1:l-N},{x0:l,x1:l+N}];return CONFIG.configure(t.selectAll().data(y).enter().append("circle").attr("cx",t=>t.x0).attr("cy",d).attr("r",u),CONFIG.trainPhoton)}function addTracks(t){const a=AX_MIN_X+.05*AX_WIDTH,n=AX_MIN_Y+.05*AX_HEIGHT,e=AX_MAX_Y-.05*AX_HEIGHT,r=(AX_MAX_X-.05*AX_WIDTH-a)/8,i=Math.ceil(9+axDistTraveled({fracOfC:1})/r),o=[];for(let t=0;t<i;t++){const n=a+t*r,[e,i]=[{x:n,y:AX_MIN_Y},{x:n,y:AX_MAX_Y}].map(transAxisToCanvas);o.push({p1:e,p2:i,baseX:e.x})}const s=CONFIG.configure(t.selectAll().data(o).enter().append("line").attr("x1",x1).attr("y1",y1).attr("x2",x2).attr("y2",y2),CONFIG.railroadTie),A=[];return[n,e].forEach(t=>{const[a,n]=[{x:AX_MIN_X,y:t},{x:AX_MAX_X,y:t}].map(transAxisToCanvas);A.push({p1:a,p2:n})}),{ties:s,rails:CONFIG.configure(t.selectAll().data(A).enter().append("line").attr("x1",x1).attr("y1",y1).attr("x2",x2).attr("y2",y2),CONFIG.railroadRail)}}const trackLines=addTracks(canvas),photons=addTrainAndLightSources(canvas),playbackInfo={animationIsPlaying:!1,animationStartDate:null,animationTimer:null,beginButton:document.getElementById("btn-run-animation"),resetButton:document.getElementById("btn-reset-animation")};function beginAnimation(){if(playbackInfo.animationIsPlaying)return;playbackInfo.animationIsPlaying=!0,playbackInfo.animationStartDate=new Date,playbackInfo.beginButton.disabled=!0,playbackInfo.resetButton.disabled=!1,playbackInfo.animationTimer=setTimeout(()=>{playbackInfo.animationIsPlaying=!1,playbackInfo.animationEndDate=new Date},TOTAL_DURATION_MS);const t=transAxisToCanvas({dx:axDistTraveled({fracOfC:CONFIG.trainSpeed})}).dx;trackLines.ties.transition().duration(0).attr("x1",t=>t.baseX).attr("x2",t=>t.baseX).transition().duration(TOTAL_DURATION_MS).ease(d3.easeLinear).attr("x1",a=>a.baseX-t).attr("x2",a=>a.baseX-t),photons.transition().duration(0).attr("cx",t=>t.x0).transition().duration(TOTAL_DURATION_MS).ease(d3.easeLinear).attr("cx",t=>t.x1)}function stopAnimation(){playbackInfo.animationIsPlaying=!1,clearTimeout(playbackInfo.animationTimer),playbackInfo.beginButton.disabled=!1,playbackInfo.resetButton.disabled=!0;const t=(new Date).getTime()-playbackInfo.animationStartDate.getTime(),a=CONFIG.easingForAnimationReset,n=CONFIG.durationMSOfAnimationReset*Math.min(1,.5*(1+t/TOTAL_DURATION_MS));trackLines.ties.transition().duration(n).ease(a).attr("x1",t=>t.baseX).attr("x2",t=>t.baseX),photons.transition().duration(n).ease(a).attr("cx",t=>t.x0)}updateTrainSpeed();
</script>
</body>
</html>